@page "/Partner"
@model Acme.OnlineCourses.Pages.Partner.PartnerModel
@{
}

@section styles {
    <abp-style src="/Pages/Partner/Partner.cshtml.css" />
    <style>
        .select2-container--default .select2-selection--single {
            height: 38px;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
        }

            .select2-container--default .select2-selection--single .select2-selection__rendered {
                line-height: 38px;
            }

            .select2-container--default .select2-selection--single .select2-selection__arrow {
                height: 36px;
            }
            
        /* Validation styles */
        .is-invalid {
            border-color: #dc3545 !important;
        }
        
        .is-valid {
            border-color: #28a745 !important;
        }
        
        .invalid-feedback {
            display: block;
            width: 100%;
            margin-top: 0.25rem;
            font-size: 80%;
            color: #dc3545;
        }
        
        .select2-container--default.is-invalid .select2-selection--single {
            border-color: #dc3545 !important;
        }
        
        .select2-container--default.is-valid .select2-selection--single {
            border-color: #28a745 !important;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css" rel="stylesheet">
}
@section scripts {
    <abp-script src="/Pages/Partner/Partner.cshtml.js" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>
    <!-- Add jQuery validate -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            $('#locationFilter').select2({
                placeholder: "Tìm kiếm",
                allowClear: false,
                width: '100%'
            });

            // When select2 changes, submit the form
            $('#locationFilter').on('change', function() {
                $('#filterForm').submit();
            });
            
            // Initialize select2 for location dropdown in partner form
            $('#location').select2({
                placeholder: "Chọn địa điểm",
                allowClear: true,
                width: '100%'
            });
            
            // Add validation rules
            $.validator.setDefaults({
                ignore: [] // Don't ignore hidden fields (important for select2)
            });
            
            // Initialize validation
            var validator = $('#partnerForm').validate({
                rules: {
                    fullName: {
                        required: true,
                        minlength: 2,
                        maxlength: 100
                    },
                    phone: {
                        required: true,
                        digits: true,
                        minlength: 10,
                        maxlength: 15
                    },
                    email: {
                        required: true,
                        email: true
                    },
                    address: {
                        required: true,
                        minlength: 5
                    },
                    orgName: {
                        required: true,
                        minlength: 2
                    },
                    position: {
                        required: true
                    },
                    location: {
                        required: true
                    },
                    message: {
                        required: false,
                        minlength: 1
                    }
                },
                messages: {
                    fullName: {
                        required: "Vui lòng nhập họ tên",
                        minlength: "Họ tên phải có ít nhất 2 ký tự",
                        maxlength: "Họ tên không được vượt quá 100 ký tự"
                    },
                    phone: {
                        required: "Vui lòng nhập số điện thoại",
                        digits: "Số điện thoại chỉ được chứa số",
                        minlength: "Số điện thoại phải có ít nhất 10 số",
                        maxlength: "Số điện thoại không được vượt quá 15 số"
                    },
                    email: {
                        required: "Vui lòng nhập email",
                        email: "Vui lòng nhập email hợp lệ"
                    },
                    address: {
                        required: "Vui lòng nhập địa chỉ",
                        minlength: "Địa chỉ phải có ít nhất 5 ký tự"
                    },
                    orgName: {
                        required: "Vui lòng nhập tên tổ chức",
                        minlength: "Tên tổ chức phải có ít nhất 2 ký tự"
                    },
                    position: {
                        required: "Vui lòng nhập chức vụ"
                    },
                    location: {
                        required: "Vui lòng chọn địa điểm"
                    }
                },
                errorElement: 'div',
                errorClass: 'invalid-feedback',
                highlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-invalid').removeClass('is-valid');
                    
                    // For Select2 elements
                    if ($(element).hasClass('select2-hidden-accessible')) {
                        $(element).next('span.select2').addClass('is-invalid').removeClass('is-valid');
                    }
                },
                unhighlight: function(element, errorClass, validClass) {
                    $(element).addClass('is-valid').removeClass('is-invalid');
                    
                    // For Select2 elements
                    if ($(element).hasClass('select2-hidden-accessible')) {
                        $(element).next('span.select2').addClass('is-valid').removeClass('is-invalid');
                    }
                },
                errorPlacement: function(error, element) {
                    if (element.hasClass('select2-hidden-accessible')) {
                        error.insertAfter(element.next('span.select2'));
                    } else {
                        error.insertAfter(element);
                    }
                }
            });
            
            // Handle form submission
            $('#partnerForm').on('submit', function(e) {
                e.preventDefault();
                
                // Force validate all fields
                validator.form();
                
                // Check if form is valid
                if (!validator.valid()) {
                    // Show error message
                    Swal.fire({
                        title: 'Lỗi!',
                        text: 'Vui lòng điền đầy đủ thông tin bắt buộc',
                        icon: 'error',
                        confirmButtonText: 'Đóng'
                    });
                    
                    // Scroll to first error
                    var firstError = $(".is-invalid:first");
                    if (firstError.length) {
                        $('html, body').animate({
                            scrollTop: firstError.offset().top - 100
                        }, 500);
                    }
                    
                    return false;
                }
                
                // Get form data
                var formData = {
                    PartnerApplication: {
                        FullName: $('#fullName').val(),
                        PhoneNumber: $('#phone').val(),
                        Email: $('#email').val(),
                        Address: $('#address').val(),
                        OrganizationName: $('#orgName').val(),
                        Position: $('#position').val(),
                        CityCode: $('#location').val(),
                        Message: $('#message').val()
                    }
                };
                
                // Show loading state
                var $btn = $('.btn-register').prop('disabled', true).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Đang xử lý...');
                
                // Send AJAX request
                $.ajax({
                    url: '/Partner?handler=Register',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    headers: {
                        'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            // Show success message
                            Swal.fire({
                                title: 'Thành công!',
                                text: 'Đăng ký đối tác thành công. Chúng tôi sẽ liên hệ với bạn sớm.',
                                icon: 'success',
                                confirmButtonText: 'Đóng'
                            });
                            
                            // Reset form and validation
                            $('#partnerForm')[0].reset();
                            $('#partnerForm').find('.is-valid').removeClass('is-valid');
                            $('#location').val('').trigger('change');
                        } else {
                            // Show error message
                            Swal.fire({
                                title: 'Lỗi!',
                                text: response.message || 'Có lỗi xảy ra, vui lòng thử lại.',
                                icon: 'error',
                                confirmButtonText: 'Đóng'
                            });
                        }
                    },
                    error: function() {
                        // Show error message
                        Swal.fire({
                            title: 'Lỗi!',
                            text: 'Có lỗi xảy ra khi gửi thông tin, vui lòng thử lại.',
                            icon: 'error',
                            confirmButtonText: 'Đóng'
                        });
                    },
                    complete: function() {
                        // Restore button state
                        $btn.prop('disabled', false).text('Đăng ký ngay');
                    }
                });
            });
        });
    </script>
}

<div class="partner-page">
    <div class="container py-5">
        <div class="row">
            <div class="col-lg-6">
                <div class="section-title">
                    <div class="subtitle">Đối tác của chúng tôi</div>
                    <h1 class="main-heading">Đối tác của chúng tôi</h1>
                </div>

                <div class="description mb-4">
                    <p>Chúng tôi tự hào phân phối chương trình trên toàn quốc, kết nối với các trung tâm đối tác đáng tin cậy để mang đến sự hỗ trợ tốt nhất cho bạn. Với mạng lưới rộng khắp, đội ngũ chuyên nghiệp của chúng tôi luôn sẵn sàng lắng nghe và giúp đỡ bạn trong quá trình học tập.</p>
                    <p>Hãy liên hệ với chúng tôi, chúng tôi cam kết đồng hành cùng bạn trên hành trình học tập và phát triển.</p>
                </div>

                <form method="get" id="filterForm">
                    <div class="partner-filter mb-4">
                        <select class="form-select" id="locationFilter" name="SelectedLocationId" aria-label="Chọn địa điểm" onchange="this.form.submit()">
                            <option value="">Tất cả địa điểm</option>
                            @foreach (var location in Model.Locations)
                            {
                                <option value="@location.Value" selected="@(location.Selected ? "selected" : null)">@location.Text</option>
                            }
                        </select>
                    </div>
                </form>

                <div class="partner-table-container">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Tên đối tác</th>
                                <th>Địa chỉ</th>
                            </tr>
                        </thead>
                        <tbody>
                        <tbody>
                            @if (Model.Agencies != null && Model.Agencies.Any())
                            {
                                @foreach (var partner in Model.Agencies)
                                {
                                    <tr>
                                        <td>@partner.Name</td>
                                        <td>@partner.Address</td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="2" class="text-center">Không tìm thấy đối tác nào</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-lg-6 d-flex align-items-center justify-content-center">
                <div class="vietnam-map">
                    <img src="~/images/vietnam_map.jpg" alt="Map of Vietnam" class="img-fluid">
                </div>
            </div>
        </div>
    </div>
</div>


<div class="become-partner-page">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="text-center mb-4">
                    <p class="subtitle">Trở thành một phần của chúng tôi</p>
                    <h1 class="main-title">Trở thành đối tác của chúng tôi</h1>
                </div>

                <div class="description text-center mb-5">
                    <p>TESOL Channel mong muốn hợp tác với các trung tâm, trường học uy tín, tập trung vào chất lượng để phân phối các chương trình TESOL Online của LTI Australia không chỉ trên khắp Việt Nam mà còn vươn xa hơn nữa. Bằng cách làm việc cùng nhau, chúng ta tạo ra những cơ hội để phát triển, thích nghi và thành công trong lĩnh vực giáo dục tiếng Anh đầy biến động.</p>
                </div>

                <div class="partner-form-container">
                    <form id="partnerForm" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-3">
                            <label for="fullName" class="form-label">Họ & Tên *</label>
                            <input type="text" class="form-control" id="fullName" name="fullName" placeholder="Nhập Họ & Tên" required="required">
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="phone" class="form-label">Số điện thoại *</label>
                                <input type="tel" class="form-control" id="phone" name="phone" placeholder="Nhập số điện thoại" required="required">
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">Email *</label>
                                <input type="email" class="form-control" id="email" name="email" placeholder="Nhập email" required="required">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="address" class="form-label">Địa chỉ *</label>
                            <input type="text" class="form-control" id="address" name="address" placeholder="Nhập địa chỉ" required="required">
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="orgName" class="form-label">Tên tổ chức *</label>
                                <input type="text" class="form-control" id="orgName" name="orgName" placeholder="Nhập tên tổ chức" required="required">
                            </div>
                            <div class="col-md-6">
                                <label for="position" class="form-label">Chức vụ *</label>
                                <input type="text" class="form-control" id="position" name="position" placeholder="Nhập chức vụ của bạn" required="required">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="location" class="form-label">Địa điểm *</label>
                            <select class="form-select" id="location" name="location" required="required">
                                <option value="">Chọn địa điểm</option>
                                @foreach (var location in Model.Locations)
                                {
                                    <option value="@location.Value">@location.Text</option>
                                }
                            </select>
                        </div>

                        <div class="mb-4">
                            <label for="message" class="form-label">Tin nhắn</label>
                            <textarea class="form-control" id="message" name="message" rows="5" placeholder="Nhập nội dung"></textarea>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-register">Đăng ký ngay</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .become-partner-page {
        background-color: #f0f7ff;
        min-height: calc(100vh - 180px);
        padding: 40px 0;
    }

    .subtitle {
        font-size: 1rem;
        font-weight: 500;
        margin-bottom: 5px;
    }

    .main-title {
        color: #0a2463;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }

    .description {
        color: #465670;
        line-height: 1.7;
        font-size: 1rem;
    }

    .partner-form-container {
        background-color: #ffffff;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .form-label {
        font-weight: bold;
        color: #343a40;
        margin-bottom: 0.5rem;
    }

    .form-control {
        padding: 0.75rem 1rem;
        border: 1px solid #ced4da;
        border-radius: 4px;
    }

        .form-control:focus {
            border-color: #0056b3;
            box-shadow: 0 0 0 0.2rem rgba(0, 86, 179, 0.15);
        }

    .btn-register {
        background-color: #0a3b7d;
        border: none;
        padding: 0.75rem 2.5rem;
        font-weight: 600;
        border-radius: 4px;
        transition: all 0.3s ease;
    }

        .btn-register:hover {
            background-color: #072c5e;
            transform: translateY(-2px);
        }

    /* Responsive adjustments */
    @@media (max-width: 768px) {
        .main-title {
            font-size: 2rem;
        }

        .partner-form-container {
            padding: 20px;
        }
    }

    @@media (max-width: 576px) {
        .main-title {
            font-size: 1.75rem;
        }

        .become-partner-page {
            padding: 20px 0;
        }
    }
</style>



@await Html.PartialAsync("_Footer")